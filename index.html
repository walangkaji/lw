<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
    <head>
        <script src="https://getbootstrap.com/docs/5.3/assets/js/color-modes.js"></script>

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="" />
        <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors" />
        <meta name="generator" content="Hugo 0.122.0" />
        <title>LW</title>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" />

        <link href="https://getbootstrap.com/docs/5.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

        <!-- Favicons -->
        <link rel="apple-touch-icon" href="https://getbootstrap.com/docs/5.3/assets/img/favicons/apple-touch-icon.png" sizes="180x180" />
        <link rel="icon" href="https://getbootstrap.com/docs/5.3/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png" />
        <link rel="icon" href="https://getbootstrap.com/docs/5.3/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png" />
        <link rel="mask-icon" href="https://getbootstrap.com/docs/5.3/assets/img/favicons/safari-pinned-tab.svg" color="#712cf9" />
        <link rel="icon" href="https://getbootstrap.com/docs/5.3/assets/img/favicons/favicon.ico" />
        <meta name="theme-color" content="#712cf9" />
    </head>
    <body>
        <main>
            <div class="pricing-header p-3 pb-md-4 mx-auto text-center">
                <h1 class="display-4 fw-normal text-body-emphasis" id="current-time"></h1>
            </div>
            <div class="container py-4">
                <div class="row align-items-md-stretch">
                    <div class="col-md-6 mb-3">
                        <div class="h-100 p-5 rounded-3 border rounded-3">
                            <form>
                                <h1 class="h3 mb-3 fw-normal text-center">Hero Exp</h1>
                                <div class="row g-3 mb-3">
                                    <div class="col-md-6">
                                        <label for="hero-from-level" class="form-label">From Level:</label>
                                        <input type="number" min="1" max="155" id="hero-from-level" class="form-control" placeholder="e.g. 100" required />
                                    </div>
                                    <div class="col-md-6">
                                        <label for="hero-to-level" class="form-label">To Level:</label>
                                        <input type="number" min="2" max="155" id="hero-to-level" class="form-control" placeholder="e.g. 125" required />
                                    </div>
                                </div>
                                <p id="result-hero-exp" class="alert alert-info">Enter a value to see EXP needed</p>
                            </form>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="h-100 p-5 rounded-3 border rounded-3">
                            <form>
                                <h1 class="h3 mb-3 fw-normal text-center">Time Distance</h1>
                                <div class="mb-3">
                                    <label for="time-distance-input" class="form-label">Target time:</label>
                                    <input type="time" id="time-distance-input" class="form-control" required />
                                </div>
                                <p id="output-time-distance" class="alert alert-info">Enter a target time to see the result.</p>
                            </form>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="h-100 p-5 rounded-3 border rounded-3">
                            <form>
                                <h1 class="h3 mb-3 fw-normal text-center">Queue Time Calculator</h1>
                                <div class="mb-3">
                                    <label class="form-label">Enter number of people in queue:</label>
                                    <input type="number" id="queue-input" min="1" class="form-control" placeholder="e.g. 64" required />
                                </div>
                                <p id="queue-result" class="alert alert-info">Enter a value to see your turn time.</p>
                            </form>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="h-100 p-5 rounded-3 border rounded-3">
                            <table class="table table-sm table-hover" id="eventTable">
                                <thead>
                                    <tr>
                                        <th scope="col">Day</th>
                                        <th scope="col">Start</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Countdown</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <script src="https://getbootstrap.com/docs/5.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);

            // Get & Set queue from localStorage
            loadLocalItem('#queue-input', 'queue_number', calculateQueue);
            $('#queue-input').on('input', (e) => saveLocalItem('queue_number', e.target.value, calculateQueue));

            // Get & Set time distance from localStorage
            loadLocalItem('#time-distance-input', 'time_distance', calculateTimeDifference);
            $('#time-distance-input').on('input', (e) => saveLocalItem('time_distance', e.target.value, calculateTimeDifference));

            // Get & Set hero exp from localStorage
            loadLocalItem('#hero-from-level', 'hero_from_level');
            loadLocalItem('#hero-to-level', 'hero_to_level');
            heroCalc();
            $('#hero-from-level, #hero-to-level').on('input', (e) => heroCalc());

            function heroCalc() {
                const fromLevel = $('#hero-from-level').val();
                const toLevel = $('#hero-to-level').val();

                if (parseInt(fromLevel) >= parseInt(toLevel)) {
                    $('#result-hero-exp').text('Invalid level input').attr('class', 'alert alert-danger');
                }

                let exp = calculateExp(parseInt(fromLevel), parseInt(toLevel));

                if (exp !== 0) {
                    $('#result-hero-exp')
                        .text(formatNumber(exp) + ' EXP needed')
                        .attr('class', 'alert alert-success');
                } else {
                    // $('#result-hero-exp').text('Invalid level').attr('class', 'alert alert-danger');
                }

                saveLocalItem('hero_from_level', fromLevel);
                saveLocalItem('hero_to_level', toLevel);
            }

            function loadLocalItem(domId, keyItem, callback) {
                const item = localStorage.getItem(keyItem);
                if (item) {
                    $(domId).val(item);
                    if (callback) {
                        callback();
                    }
                }
            }

            function saveLocalItem(keyItem, itemValue, callback) {
                localStorage.setItem(keyItem, itemValue);
                if (callback) {
                    callback();
                }
            }

            function updateCurrentTime() {
                const now = new Date();
                const currentTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Jakarta' }));
                const timeString = now.toTimeString().split(' ')[0];
                $('#current-time').text(`${timeString} WIB`);
            }

            function calculateQueue() {
                const queue = parseInt($('#queue-input').val());

                if (isNaN(queue) || queue <= 0) {
                    $('#queue-result').text('Please enter a valid number of people in the queue').attr('class', 'alert alert-danger');
                } else {
                    const now = new Date();
                    const currentTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Jakarta' }));
                    const endDate = new Date(currentTime.getTime() + queue * 5 * 60000);

                    const resultTime = endDate.toTimeString().split(':').slice(0, 2).join(':');
                    $('#queue-result').text(`Your turn will be at approximately ${resultTime} WIB`).attr('class', 'alert alert-success');
                }
            }

            function calculateTimeDifference() {
                const targetTime = $('#time-distance-input').val();
                if (!targetTime) return;

                const now = new Date();
                const [hours, minutes] = targetTime.split(':').map(Number);
                let targetDate = new Date(now);
                targetDate.setHours(hours, minutes, 0, 0);

                if (targetDate < now) {
                    targetDate.setDate(targetDate.getDate() + 1);
                }

                const diffMs = targetDate - now;
                const diffMinutes = Math.floor(diffMs / 60000);
                const days = Math.floor(diffMinutes / 1440);
                const hoursLeft = Math.floor((diffMinutes % 1440) / 60);
                const minutesLeft = diffMinutes % 60;

                $('#output-time-distance')
                    .text(`${days} day${days !== 1 ? 's' : ''} ${hoursLeft} hour${hoursLeft !== 1 ? 's' : ''} ${minutesLeft} minute${minutesLeft !== 1 ? 's' : ''}`)
                    .attr('class', 'alert alert-success');
            }

            function formatNumber(num) {
                if (num < 1000) return num.toString();
                if (num < 1000000) return (num / 1000).toFixed(1) + 'K';
                if (num < 1000000000) return (num / 1000000).toFixed(2) + 'M';
                return (num / 1000000000).toFixed(2) + 'G';
            }

            function calculateExp(fromLevel, toLevel) {
                const exps = [
                    0, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2300, 2700, 3200, 3900, 4600, 5500, 6600, 8000, 9500, 12000, 14000, 17000, 20000, 24000, 29000, 35000, 41000, 49000, 59000, 71000, 85000, 110000, 130000,
                    150000, 180000, 220000, 260000, 310000, 370000, 440000, 530000, 630000, 760000, 910000, 1100000, 1400000, 1600000, 1900000, 2100000, 2300000, 2500000, 2800000, 3100000, 3400000, 3700000, 4100000, 4500000, 4900000, 5400000, 5900000, 6500000, 7200000, 7900000, 8700000, 9500000,
                    11000000, 12000000, 13000000, 13000000, 14000000, 14000000, 15000000, 16000000, 17000000, 18000000, 19000000, 20000000, 21000000, 22000000, 23000000, 24000000, 25000000, 26000000, 27000000, 28000000, 30000000, 31000000, 33000000, 35000000, 37000000, 39000000, 41000000, 43000000,
                    45000000, 47000000, 49000000, 51000000, 53000000, 55000000, 57000000, 59000000, 61000000, 63000000, 65000000, 67000000, 69000000, 71000000, 73000000, 75000000, 77000000, 79000000, 81000000, 83000000, 85000000, 87000000, 89000000, 91000000, 93000000, 95000000, 97000000, 100000000,
                    105000000, 110000000, 115000000, 120000000, 125000000, 130000000, 135000000, 140000000, 145000000, 150000000, 155000000, 160000000, 165000000, 170000000, 175000000, 180000000, 185000000, 200000000, 215000000, 230000000, 245000000, 260000000,
                ];

                if (fromLevel >= toLevel) {
                    return 0;
                }

                let totalEXP = 0;
                for (let level = fromLevel; level < toLevel; level++) {
                    totalEXP += exps[level];
                }

                return totalEXP;
            }
        </script>

        <script>
            const eventsData = {
                'Day 1': [
                    { time: '9:00:00', name: 'Tech Reasearch' },
                    { time: '13:00:00', name: 'Drone Boost' },
                    { time: '17:00:00', name: 'Hero Advancement' },
                    { time: '21:00:00', name: 'City Building' },
                    { time: '1:00:00', name: 'Unit Progression' },
                    { time: '5:00:00', name: 'Tech Reasearch' },
                ],
                'Day 2': [
                    { time: '9:00:00', name: 'Drone Boost' },
                    { time: '13:00:00', name: 'Hero Advancement' },
                    { time: '17:00:00', name: 'City Building' },
                    { time: '21:00:00', name: 'Unit Progression' },
                    { time: '1:00:00', name: 'Tech Reasearch' },
                    { time: '5:00:00', name: 'Drone Boost' },
                ],
                'Day 3': [
                    { time: '9:00:00', name: 'Hero Advancement' },
                    { time: '13:00:00', name: 'City Building' },
                    { time: '17:00:00', name: 'Unit Progression' },
                    { time: '21:00:00', name: 'Tech Reasearch' },
                    { time: '1:00:00', name: 'Drone Boost' },
                    { time: '5:00:00', name: 'Hero Advancement' },
                ],
                'Day 4': [
                    { time: '9:00:00', name: 'City Building' },
                    { time: '13:00:00', name: 'Unit Progression' },
                    { time: '17:00:00', name: 'Tech Reasearch' },
                    { time: '21:00:00', name: 'Drone Boost' },
                    { time: '1:00:00', name: 'Hero Advancement' },
                    { time: '5:00:00', name: 'City Building' },
                ],
                'Day 5': [
                    { time: '9:00:00', name: 'Hero Advancement' },
                    { time: '13:00:00', name: 'City Building' },
                    { time: '17:00:00', name: 'Unit Progression' },
                    { time: '21:00:00', name: 'Tech Reasearch' },
                    { time: '1:00:00', name: 'Drone Boost' },
                    { time: '5:00:00', name: 'Hero Advancement' },
                ],
                'Day 6': [
                    { time: '9:00:00', name: 'City Building' },
                    { time: '13:00:00', name: 'Unit Progression' },
                    { time: '17:00:00', name: 'Tech Reasearch' },
                    { time: '21:00:00', name: 'Drone Boost' },
                    { time: '1:00:00', name: 'Hero Advancement' },
                    { time: '5:00:00', name: 'City Building' },
                ],
                'Day 7': [
                    { time: '9:00:00', name: 'Unit Progression' },
                    { time: '13:00:00', name: 'Tech Reasearch' },
                    { time: '17:00:00', name: 'Drone Boost' },
                    { time: '21:00:00', name: 'Hero Advancement' },
                    { time: '1:00:00', name: 'City Building' },
                    { time: '5:00:00', name: 'Unit Progression' },
                ],
            };

            function getNow() {
                return new Date(new Date().toLocaleString('en-US', { timeZone: 'Asia/Jakarta' }));
            }

            function formatCountdown(ms) {
                if (ms < 0) ms = 0;
                let sec = Math.floor(ms / 1000);
                const h = Math.floor(sec / 3600);
                sec %= 3600;
                const m = Math.floor(sec / 60);
                sec %= 60;
                return `${h}h ${m}m ${sec}s`;
            }

            function eventAbsoluteDate(day, time) {
                let date = getNow();
                const dayIndex = parseInt(day.split(' ')[1]) - 1;
                const startOfWeek = new Date(date);
                startOfWeek.setDate(startOfWeek.getDate() - (startOfWeek.getDay() - 1));
                const target = new Date(startOfWeek);
                target.setDate(startOfWeek.getDate() + dayIndex);
                const [h, m, s] = time.split(':').map(Number);
                target.setHours(h, m, s, 0);
                if (h < 6) target.setDate(target.getDate() + 1);
                return target;
            }

            function renderTable() {
                const tbody = document.querySelector('#eventTable tbody');
                tbody.innerHTML = '';
                const now = getNow();

                const flatEvents = [];
                for (const [day, arr] of Object.entries(eventsData)) {
                    arr.forEach((ev) => {
                        flatEvents.push({ day, ...ev, date: eventAbsoluteDate(day, ev.time) });
                    });
                }
                flatEvents.sort((a, b) => a.date - b.date);

                let currentIndex = flatEvents.findIndex((e, i) => {
                    const next = flatEvents[i + 1];
                    return now >= e.date && (!next || now < next.date);
                });
                if (currentIndex === -1) {
                    currentIndex = flatEvents.findIndex((e) => e.date > now) - 1;
                    if (currentIndex < 0) currentIndex = 0;
                }

                const currentDay = flatEvents[currentIndex].day;
                const nextDay = 'Day ' + (parseInt(currentDay.split(' ')[1]) + 1);
                const showEvents = flatEvents.filter((e) => e.day === currentDay || e.day === nextDay);

                showEvents.forEach((ev, i) => {
                    let rowClass = '';
                    let status;
                    if (flatEvents[currentIndex] === ev) {
                        status = 'Ongoing';
                        rowClass = 'text-success fw-bold';
                    } else if (flatEvents[currentIndex + 1] === ev) {
                        status = formatCountdown(ev.date - now);
                        rowClass = 'text-warning';
                    } else if (ev.date < now) {
                        status = 'passed';
                        rowClass = 'text-secondary';
                    } else {
                        status = formatCountdown(ev.date - now);
                    }

                    tbody.innerHTML += `<tr><td class="${rowClass}">${ev.day}</td><td class="${rowClass}">${ev.time}</td><td class="${rowClass}">${ev.name}</td><td class="${rowClass}">${status}</td></tr>`;
                });
            }

            setInterval(renderTable, 1000);
            renderTable();
        </script>
    </body>
</html>
